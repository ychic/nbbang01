<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="nbbang.mybatis.mapper.partybbs">

	<resultMap type="partyBbsDTO" id="partyBbsDTOResult">
		<result column="partyNo" property="partyNo"/>
		<result column="partyTitle" property="partyTitle"/>
		<result column="partyContent" property="partyContent"/>
		<result column="partyPostdate" property="partyPostdate"/>
		<result column="partyMaxCapacity" property="partyMaxCapacity"/>
		<result column="partyActivation" property="partyActivation"/>
		<result column="partyAllotmentPrice" property="partyAllotmentPrice"/>
		<result column="partyCategoryName" property="partyCategoryName"/>
		<result column="partyMembership" property="partyMembership"/>
		<result column="email" property="email"/>
		<result column="partyMatchdate" property="partyMatchdate"/>
		<result column="partyMember" property="partyMatchdate"/>
	</resultMap>

	<select id="partyBbsSelectList" parameterType="Map" resultType="partyBbsDTO">
		SELECT * FROM 
		(SELECT T.*, ROWNUM R FROM 
			(SELECT p.*, m.nickname, m.profile, m.oringinprofile FROM 
				partybbs p JOIN member m ON m.email = p.email
				ORDER BY partyactivation DESC, partyno DESC) T)
		WHERE R BETWEEN #{start} AND #{end}
	</select>
	
	<select id="netflixList" parameterType="Map" resultType="partyBbsDTO">
		SELECT * FROM 
		(SELECT T.*, ROWNUM R FROM 
			(SELECT p.*, m.nickname, m.profile, m.oringinprofile FROM 
				partybbs p JOIN member m ON m.email = p.email
				ORDER BY partyactivation DESC, partyno DESC) T)
		WHERE R BETWEEN #{start} AND #{end} AND partyCategoryName = 'netflix'
	</select>
	
	<select id="watchaList" parameterType="Map" resultType="partyBbsDTO">
		SELECT * FROM 
		(SELECT T.*, ROWNUM R FROM 
			(SELECT p.*, m.nickname, m.profile, m.oringinprofile FROM 
				partybbs p JOIN member m ON m.email = p.email
				ORDER BY partyactivation DESC, partyno DESC) T)
		WHERE R BETWEEN #{start} AND #{end} AND partyCategoryName = 'watcha'
	</select>
	
	<select id="disneyList" parameterType="Map" resultType="partyBbsDTO">
		SELECT * FROM 
		(SELECT T.*, ROWNUM R FROM 
			(SELECT p.*, m.nickname, m.profile, m.oringinprofile FROM 
				partybbs p JOIN member m ON m.email = p.email
				ORDER BY partyactivation DESC, partyno DESC) T)
		WHERE R BETWEEN #{start} AND #{end} AND partyCategoryName = 'disney'
	</select>
	
	<select id="laftelList" parameterType="Map" resultType="partyBbsDTO">
		SELECT * FROM 
		(SELECT T.*, ROWNUM R FROM 
			(SELECT p.*, m.nickname, m.profile, m.oringinprofile FROM 
				partybbs p JOIN member m ON m.email = p.email
				ORDER BY partyactivation DESC, partyno DESC) T)
		WHERE R BETWEEN #{start} AND #{end} AND partyCategoryName = 'laftel'
	</select>
	
	<select id="tvingList" parameterType="Map" resultType="partyBbsDTO">
		SELECT * FROM 
		(SELECT T.*, ROWNUM R FROM 
			(SELECT p.*, m.nickname, m.profile, m.oringinprofile FROM 
				partybbs p JOIN member m ON m.email = p.email
				ORDER BY partyactivation DESC, partyno DESC) T)
		WHERE R BETWEEN #{start} AND #{end} AND partyCategoryName = 'tving'
	</select>
	
	<select id="wavveList" parameterType="Map" resultType="partyBbsDTO">
		SELECT * FROM 
		(SELECT T.*, ROWNUM R FROM 
			(SELECT p.*, m.nickname, m.profile, m.oringinprofile FROM 
				partybbs p JOIN member m ON m.email = p.email
				ORDER BY partyactivation DESC, partyno DESC) T)
		WHERE R BETWEEN #{start} AND #{end} AND partyCategoryName = 'wavve'
	</select>
	
	<select id="partyBbsTotalRowCount" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM partybbs p JOIN member m ON m.email = p.email
	</select>

	<insert id="partyBbsInsert" parameterType="Map">
		INSERT INTO partybbs
		VALUES(SEQ_partybbs_partyno.NEXTVAL,#{partyTitle},
		#{partyContent},SYSDATE,#{partyMaxCapacity},#{partyActivation},
		#{partyAllotmentPrice},#{partyCategoryName},#{partyMembership},#{email},null)
	</insert>
	
	<delete id="partyBbsDelete" parameterType="Map">
		DELETE partybbs WHERE partyno = #{partyNo}
	</delete>
	
	<select id="partybbsSelectOne" parameterType="Map" resultMap="partyBbsDTOResult">
		SELECT p.*,m.nickname,m.profile, m.oringinprofile FROM member m JOIN partybbs p ON m.email=p.email WHERE partyNo=#{partyNo}	
	</select>
	
	<select id="getActivation" parameterType="Map" resultType="String">
		SELECT partyactivation FROM partybbs WHERE partyno = #{partyNo}
	</select>
	
	<update id="setActivation" parameterType="Map" >
		UPDATE partybbs SET partyactivation ='false' WHERE partyno=#{partyNo}
	</update>
	
	<select id="getList" parameterType="String" resultType="partyBbsDTO">
		SELECT p.*, pm.pmmember, pm.partyleader FROM
		partybbs p JOIN partymember pm ON p.partyno = pm.partyno
		WHERE pm.pmmember = #{email}
	</select>
	
	<select id="nowPartyMember" parameterType="Map" resultType="String">
		SELECT COUNT(*) FROM partymember WHERE partyno = #{partyNo}
	</select>
	
	<select id="nowPartyMemberReport" parameterType="Map" resultType="String">
		SELECT COUNT(*) FROM partymember WHERE partyno = #{partyNo}
	</select>
	
	<select id="getPartyContent" parameterType="Map" resultType="String">
		SELECT partycontent FROM partybbs WHERE partyno = #{partyNo}
	</select>
	
	<select id="chatCheck" parameterType="Map" resultType="String">
		SELECT count(*) FROM chat
		WHERE partyno = #{partyNo} AND 
		participant= #{participant} AND
		bbswriter= #{bbswriter}
	</select>
	
	<!-- 아이디 중복 체크 -->
	<select id="categoryCheck" resultType="int">
		SELECT COUNT(*) FROM partybbs
		WHERE partycategoryname = #{partyCategoryName} and email = #{email}
	</select>
	
</mapper> 