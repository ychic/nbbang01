<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- 쿼리문 작성 페이지 -->
  
<mapper namespace="nbbang.mybatis.mapper.report">

	<resultMap type="reportDTO" id="reportDTOResult">
	
		<result column="reportno" property="reportno"/>
		<result column="reportbbs" property="reportbbs"/>
		<result column="reportcontent" property="reportcontent"/>
		<result column="reporttype" property="reporttype"/>
		
		<result column="inqno" property="inqno"/>
		<result column="partyNo" property="partyNo"/>
		<result column="ussrno" property="ussrno"/>
		<result column="reportregistdate" property="reportregistdate"/>
		<result column="email" property="email"/>
		 
	</resultMap>

	<insert id="reportInsert" parameterType="Map" >
		INSERT INTO report VALUES(SEQ_report_reportno.NEXTVAL,#{reportbbs},#{reportcontent},#{reporttype},SYSDATE,#{email},
		#{inqno},null,null,null)
	</insert>
	<insert id="reportInsertParty" parameterType="Map" >
		INSERT INTO report VALUES(SEQ_report_reportno.NEXTVAL,#{reportbbs},#{reportcontent},#{reporttype},SYSDATE,#{email},
		null,#{partyNo},null,null)
	</insert>
	<insert id="reportInsert404" parameterType="Map" >
		INSERT INTO report VALUES(SEQ_report_reportno.NEXTVAL,#{reportbbs},#{reportcontent},#{reporttype},SYSDATE,#{email},
		null,null,null,null)
	</insert>
	<insert id="reportInsertUssr" parameterType="Map" >
		INSERT INTO report VALUES(SEQ_report_reportno.NEXTVAL,#{reportbbs},#{reportcontent},#{reporttype},SYSDATE,#{email},
		null,null,#{ussrno},null)
	</insert>
	
	<insert id="reportInsertChat" parameterType="Map" >
		INSERT INTO report VALUES(SEQ_report_reportno.NEXTVAL,#{reportbbs},#{reportcontent},#{reporttype},SYSDATE,#{email},
		null,null,null,#{chatno})
	</insert>
	
	
	<select id="reportSelectList" parameterType="Map" resultType="reportDTO">
		SELECT * FROM 
		(SELECT T.*,ROWNUM R FROM
			(SELECT r.*,m.nickname FROM report r JOIN member m ON m.email=r.email 
			<if test="searchWord !=null">
				WHERE ${searchColumn} LIKE '%' || #{searchWord} || '%'
			</if>
			ORDER BY reportno DESC) T) 
		WHERE R BETWEEN #{start} AND #{end}
	</select>
	
	<select id="reportTotalRowCount" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM report r JOIN member m ON m.email=r.email
		<if test="searchWord != null">
			WHERE ${searchColumn} LIKE '%' || #{searchWord} || '%'
		</if>
	</select>
	
	
	
</mapper>